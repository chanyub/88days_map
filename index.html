<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>88 Days Map Australia - Working Holiday Visa Regional Work Areas | í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì ì§€ë„ | Find Eligible Postcodes</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Complete interactive map of Australian Working Holiday Visa 88-day regional work areas. Find eligible postcodes for agriculture, hospitality, tourism jobs. Free tool for subclass 417 visa holders. í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì§€ì—­ ê·¼ë¬´ ì§€ì—­ ì™„ì „í•œ ì¸í„°ë™í‹°ë¸Œ ì§€ë„. ì„¸ì»¨ë¹„ìë¥¼ ìœ„í•œ ë†ì—…, ì ‘ê°ì—…, ê´€ê´‘ì—… ì¼ìë¦¬ ìš°í¸ë²ˆí˜¸ ì°¾ê¸°."/>
  <meta name="keywords" content="working holiday visa 88 days, australian working holiday areas, 88 days map australia, working holiday postcode, australia regional work visa, subclass 417 visa, working holiday jobs australia, backpacker jobs australia, australian visa requirements, working holiday visa extension, regional australia jobs, australia postcode map, working holiday visa guide, í˜¸ì£¼ì›Œí™€ ì„¸ì»¨, ì„¸ì»¨ë¹„ì, í˜¸ì£¼ì›Œí™€, ì„¸ì»¨ì§€ë„, ì„¸ì»¨ë¹„ì ì§€ë„, í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼, í˜¸ì£¼ ì§€ì—­ì§€ ê·¼ë¬´, í˜¸ì£¼ ë†ì¥ì¼ìë¦¬, í˜¸ì£¼ ë°±íŒ¨ì»¤ ì¼ìë¦¬, í˜¸ì£¼ ì›Œí™€ë¹„ì, ì„¸ì»¨ë¹„ì ì¡°ê±´, í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ ì—°ì¥"/>
  <meta name="author" content="í•˜ê³ ì‹¶ì€ê²Œë§ì€"/>
  <meta name="robots" content="index, follow, max-snippet:-1, max-video-preview:-1, max-image-preview:large"/>
  <meta name="googlebot" content="index, follow"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="canonical" href="https://chanyub.github.io/88days_map/"/>
  <link rel="alternate" hreflang="en" href="https://chanyub.github.io/88days_map/"/>
  <link rel="alternate" hreflang="ko" href="https://chanyub.github.io/88days_map/"/>
  <link rel="alternate" hreflang="x-default" href="https://chanyub.github.io/88days_map/"/>
  
  <!-- Structured Data for Search Engines -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "88 Days Map Australia - í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì ì§€ë„",
    "description": "Interactive map showing eligible work areas for Australian Working Holiday visa holders to complete their 88-day requirement. í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì„¸ì»¨ë¹„ì ì§€ì—­ ê·¼ë¬´ ì¸í„°ë™í‹°ë¸Œ ì§€ë„",
    "url": "https://chanyub.github.io/88days_map/",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "creator": {
      "@type": "Person",
      "name": "í•˜ê³ ì‹¶ì€ê²Œë§ì€",
      "url": "https://www.youtube.com/@%ED%95%98%EA%B3%A0%EC%8B%B6%EC%9D%80%EA%B2%8C%EB%A7%8E%EC%9D%80"
    },
    "about": {
      "@type": "Thing",
      "name": "Working Holiday Visa Australia - í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì",
      "description": "Australian Working Holiday Visa 88-day regional work requirement. í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì§€ì—­ ê·¼ë¬´ ì¡°ê±´"
    },
    "inLanguage": ["en", "ko"],
    "audience": {
      "@type": "Audience",
      "audienceType": "Working Holiday Visa Holders"
    }
  }
  </script>
  
  <!-- Open Graph / Social Media Meta Tags -->
  <meta property="og:title" content="88 Days Map Australia - í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì ì§€ë„ - Working Holiday Visa Regional Work Areas"/>
  <meta property="og:description" content="Complete interactive map of Australian Working Holiday Visa 88-day regional work areas. Find eligible postcodes for agriculture, hospitality, tourism jobs. í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì„¸ì»¨ë¹„ì ì§€ì—­ ê·¼ë¬´ ì§€ë„."/>
  <meta property="og:image" content="https://chanyub.github.io/88days_map/thumbnail.svg"/>
  <meta property="og:url" content="https://chanyub.github.io/88days_map/"/>
  <meta property="og:type" content="website"/>
  <meta property="og:site_name" content="88 Days Map Australia"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:locale:alternate" content="ko_KR"/>
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="88 Days Map Australia - í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì ì§€ë„ - Working Holiday Visa Regional Work Areas"/>
  <meta name="twitter:description" content="Complete interactive map of Australian Working Holiday Visa 88-day regional work areas. Find eligible postcodes for agriculture, hospitality, tourism jobs. í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì„¸ì»¨ë¹„ì ì§€ì—­ ê·¼ë¬´ ì§€ë„."/>
  <meta name="twitter:image" content="https://chanyub.github.io/88days_map/thumbnail.svg"/>
  <meta name="twitter:site" content="@88DaysMap"/>
  
  <!-- Additional SEO Meta Tags -->
  <meta name="theme-color" content="#4a90e2"/>
  <meta name="msapplication-TileColor" content="#4a90e2"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="88 Days Map"/>
  
  <!-- Geo Tags -->
  <meta name="geo.region" content="AU"/>
  <meta name="geo.country" content="Australia"/>
  <meta name="ICBM" content="-25.274398, 133.775136"/>
  <meta name="geo.position" content="-25.274398;133.775136"/>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json"/>
  
  <!-- Favicon and Icons -->
  <link rel="icon" type="image/svg+xml" href="thumbnail.svg"/>
  <link rel="apple-touch-icon" href="thumbnail.svg"/>
  
  <!-- Preload critical resources -->
  <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style"/>
  <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script"/>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  
  <!-- Google Analytics (GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    // Replace G-XXXXXXXXXX with your actual Google Analytics ID
    // gtag('config', 'G-XXXXXXXXXX');
  </script>
  
  <!-- Firebase Real-time Chat -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, push, onValue, serverTimestamp, limitToLast, query, set, runTransaction } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
    
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAXKhKl6tnlyKZ84YXyZRJXoIbXRpXRgAA",
      authDomain: "palpalzones.firebaseapp.com",
      databaseURL: "https://palpalzones-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "palpalzones",
      storageBucket: "palpalzones.firebasestorage.app",
      messagingSenderId: "164023944108",
      appId: "1:164023944108:web:f6f8e0707951e0757f3009",
      measurementId: "G-6QG5JB2X63"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    // Make Firebase functions available globally
    window.firebaseDB = database;
    window.firebaseRef = ref;
    window.firebasePush = push;
    window.firebaseOnValue = onValue;
    window.firebaseServerTimestamp = serverTimestamp;
    window.firebaseQuery = query;
    window.firebaseLimitToLast = limitToLast;
    window.firebaseSet = set;
    window.firebaseRunTransaction = runTransaction;
    
    // Enable real-time chat
    window.chatBackend = {
      enabled: true,
      database: database
    };
    
    console.log('ğŸ”¥ Firebase initialized successfully!');
  </script>
  <style>
    html,body,#map{height:100%;margin:0}
    #search-container{position:absolute;top:10px;left:50%;transform:translateX(-50%);z-index:1000;background:white;padding:10px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,0.2)}
    #search-input{padding:5px;width:200px;border:1px solid #ccc;border-radius:3px}
    #search-results{max-height:200px;overflow-y:auto;background:white;border:1px solid #ccc;border-top:none;display:none}
    .search-result{padding:8px;cursor:pointer;border-bottom:1px solid #eee}
    .search-result:hover{background:#f0f0f0}
    #visitor-stats{position:absolute;bottom:10px;right:10px;z-index:1000;background:rgba(255,255,255,0.9);padding:8px;border-radius:5px;font-size:12px;font-family:Arial,sans-serif}
    .stat-line{margin:2px 0}
    #legend{position:absolute;top:60px;left:10px;z-index:1000;background:rgba(255,255,255,0.95);padding:15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.3);max-width:350px;font-family:Arial,sans-serif;font-size:13px}
    .legend-title{font-weight:bold;font-size:16px;margin-bottom:10px;color:#333}
    .legend-item{display:flex;align-items:center;margin:8px 0;cursor:pointer}
    .legend-item:hover{background:#f5f5f5;border-radius:4px;padding:4px}
    .legend-color{width:20px;height:15px;margin-right:10px;border:1px solid #333;border-radius:3px}
    .legend-text{flex:1;line-height:1.3}
    .legend-category{font-weight:bold;color:#444}
    .legend-source{margin-top:15px;padding-top:10px;border-top:1px solid #ddd;font-size:11px;color:#666}
    .legend-source a{color:#0066cc;text-decoration:none}
    .legend-source a:hover{text-decoration:underline}
    #info-panel{position:absolute;top:10px;right:10px;z-index:1001;background:rgba(255,255,255,0.95);padding:15px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.3);max-width:400px;font-family:Arial,sans-serif;font-size:13px;display:none}
    .info-title{font-weight:bold;font-size:16px;margin-bottom:10px;color:#333}
    .info-content{line-height:1.5}
    .close-btn{float:right;cursor:pointer;font-size:18px;color:#666}
    .close-btn:hover{color:#000}
    #loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9999;display:flex;justify-content:center;align-items:center;color:white;font-family:Arial,sans-serif}
    .spinner{border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin-right:15px}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .loading-text{font-size:18px}
    #chat-container{position:absolute;bottom:10px;left:10px;z-index:1000;width:300px;background:rgba(255,255,255,0.95);border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.3);font-family:Arial,sans-serif;font-size:12px}
    #chat-header{background:#4a90e2;color:white;padding:8px 12px;border-radius:8px 8px 0 0;font-weight:bold;cursor:pointer;user-select:none}
    #chat-content{display:none;max-height:200px;border:1px solid #ddd;border-top:none}
    #chat-messages{height:150px;overflow-y:auto;padding:8px;background:white}
    .message{margin:4px 0;padding:4px 6px;background:#f8f9fa;border-radius:4px;word-wrap:break-word}
    .message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2px}
    .message-author{font-weight:bold;color:#333;font-size:11px}
    .message-time{font-size:10px;color:#666}
    .message-text{font-size:11px;line-height:1.3}
    #chat-input-container{padding:8px;background:#f5f5f5;border-radius:0 0 8px 8px}
    .input-row{display:flex;gap:5px;margin-bottom:5px}
    #username-input{width:80px;padding:4px;border:1px solid #ddd;border-radius:3px;font-size:11px}
    #chat-input{flex:1;padding:4px;border:1px solid #ddd;border-radius:3px;font-size:11px}
    #chat-send{padding:4px 8px;background:#4a90e2;color:white;border:none;border-radius:3px;cursor:pointer;font-size:11px}
    #chat-send:hover{background:#357abd}
    .chat-collapsed{opacity:0.8}
    #creator-info{position:absolute;bottom:10px;right:130px;z-index:1000;background:rgba(255,255,255,0.9);padding:6px 8px;border-radius:5px;font-size:10px;font-family:Arial,sans-serif;color:#666;box-shadow:0 1px 3px rgba(0,0,0,0.2)}
    #creator-info a{color:#4a90e2;text-decoration:none;margin:0 2px}
    #creator-info a:hover{text-decoration:underline}
    .creator-line{margin:1px 0}
  </style>
</head>
<body>
<div id="loading-overlay">
  <div class="spinner"></div>
  <div class="loading-text">Loading map data...</div>
</div>
<div id="search-container">
  <input type="text" id="search-input" placeholder="Search postcode or locality">
  <div id="search-results"></div>
</div>

<div id="legend">
  <div class="legend-title">Working Holiday 88-Day Areas</div>
  <div class="legend-item" onclick="showInfo(1)">
    <div class="legend-color" style="background:#ff0000"></div>
    <div class="legend-text">
      <div class="legend-category">Remote/Very Remote Australia (Table 1)</div>
      <div>Tourism and hospitality work (from 22 June 2021)</div>
    </div>
  </div>
  <div class="legend-item" onclick="showInfo(2)">
    <div class="legend-color" style="background:#ff8c00"></div>
    <div class="legend-text">
      <div class="legend-category">Australia (Table 2)</div>
      <div>Tourism and hospitality work (from 22 June 2021)</div>
    </div>
  </div>
  <div class="legend-item" onclick="showInfo(3)">
    <div class="legend-color" style="background:#ffff00"></div>
    <div class="legend-text">
      <div class="legend-category">Northern Australia (Table 3)</div>
      <div>Tourism and hospitality work (from 22 June 2021)</div>
    </div>
  </div>
  <div class="legend-item" onclick="showInfo(4)">
    <div class="legend-color" style="background:#32cd32"></div>
    <div class="legend-text">
      <div class="legend-category">Regional Australia (Table 4)</div>
      <div>Specified work (Primary industries)</div>
    </div>
  </div>
  <div class="legend-item" onclick="showInfo(5)">
    <div class="legend-color" style="background:#0078ff"></div>
    <div class="legend-text">
      <div class="legend-category">Bushfire Declared Areas (Table 5)</div>
      <div>Bushfire recovery work (after 31 July 2019)</div>
    </div>
  </div>
  <div class="legend-item" onclick="showInfo(6)">
    <div class="legend-color" style="background:#9370db"></div>
    <div class="legend-text">
      <div class="legend-category">Natural Disaster Declared Areas (Table 6)</div>
      <div>Natural disaster recovery work (from 31 Dec 2021)</div>
    </div>
  </div>
  
  <div class="legend-source">
    <strong>Source:</strong> Australian Department of Home Affairs<br>
    For detailed information, please refer to:<br>
    <a href="https://immi.homeaffairs.gov.au/what-we-do/whm-program/specified-work-conditions/specified-work-417" target="_blank">
      Official Specified Work Requirements
    </a>
  </div>
</div>

<div id="info-panel">
  <span class="close-btn" onclick="hideInfo()">&times;</span>
  <div class="info-title" id="info-title"></div>
  <div class="info-content" id="info-content"></div>
</div>

<div id="visitor-stats">
  <div class="stat-line">Total Visitors: <span id="total-visitors">0</span></div>
  <div class="stat-line">Today's Visitors: <span id="today-visitors">0</span></div>
</div>

<div id="creator-info">
  <div class="creator-line">ğŸ“ Created by <strong>í•˜ê³ ì‹¶ì€ê²Œë§ì€ğŸ‡°ğŸ‡·</strong></div>
  <div class="creator-line">ğŸ“§ <a href="#" onclick="copyEmail(event)">Contact</a> | ğŸ“º <a href="https://www.youtube.com/@%ED%95%98%EA%B3%A0%EC%8B%B6%EC%9D%80%EA%B2%8C%EB%A7%8E%EC%9D%80" target="_blank">YouTube</a></div>
</div>

<div id="chat-container" class="chat-collapsed">
  <div id="chat-header" onclick="toggleChat()">ğŸ’¬ Guestbook <span id="chat-status">ğŸ”„</span></div>
  <div id="chat-content">
    <div id="chat-messages"></div>
    <div id="chat-input-container">
      <div class="input-row">
        <input type="text" id="username-input" placeholder="Name" maxlength="20">
        <input type="text" id="chat-input" placeholder="Leave a message..." maxlength="200">
      </div>
      <button id="chat-send" onclick="sendMessage()" style="width:100%;margin-top:2px;">Send</button>
    </div>
  </div>
</div>

<div id="map"></div>

<!-- SEO Content (Hidden but readable by search engines) -->
<div style="position:absolute;left:-9999px;top:-9999px;">
  <h1>88 Days Map Australia - Working Holiday Visa Regional Work Areas</h1>
  <h2>Complete Guide to Australian Working Holiday Visa 88-Day Requirement</h2>
  
  <section>
    <h3>What is the 88-Day Requirement?</h3>
    <p>Australian Working Holiday visa (subclass 417) holders must complete 88 days of specified work in regional Australia to be eligible for a second Working Holiday visa. Our interactive map shows all eligible postcodes and work areas across Australia.</p>
  </section>
  
  <section>
    <h3>Eligible Work Areas by Category</h3>
    <h4>Remote and Very Remote Australia (Tables 1-3)</h4>
    <p>Tourism and hospitality work in remote areas including restaurants, cafes, hotels, and accommodation services. Work must be completed from 22 June 2021 onwards.</p>
    
    <h4>Regional Australia (Table 4)</h4>
    <p>Primary industry work including agriculture, mining, forestry, construction, and fishing in designated regional areas across Australia.</p>
    
    <h4>Bushfire Recovery Areas (Table 5)</h4>
    <p>Bushfire recovery and cleanup work in declared bushfire affected areas. Work must be completed after 31 July 2019.</p>
    
    <h4>Natural Disaster Areas (Table 6)</h4>
    <p>Recovery work in areas affected by floods, cyclones, and severe weather events. Applies to work completed from 31 December 2021.</p>
  </section>
  
  <section>
    <h3>How to Use This Map</h3>
    <p>Search for your postcode or locality using the search function. Click on colored areas to view detailed work requirements. Join our real-time chat to connect with other Working Holiday visa holders.</p>
  </section>
  
  <section>
    <h3>Key Features</h3>
    <ul>
      <li>Interactive postcode map with 2000+ eligible areas</li>
      <li>Real-time search for postcodes and localities</li>
      <li>Detailed work requirement information for each area type</li>
      <li>Official government source references</li>
      <li>Real-time chat community for visa holders</li>
      <li>Mobile-friendly responsive design</li>
    </ul>
  </section>
  
  <section>
    <h3>Official Information Source</h3>
    <p>All information is sourced from the Australian Department of Home Affairs official specified work requirements for Working Holiday visa subclass 417.</p>
  </section>
  
  <!-- Korean SEO Content -->
  <section lang="ko">
    <h2>í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ì ì§€ë„ - í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ 88ì¼ ì§€ì—­ê·¼ë¬´</h2>
    <h3>í˜¸ì£¼ì›Œí™€ ì„¸ì»¨ë¹„ìë€?</h3>
    <p>í˜¸ì£¼ ì›Œí‚¹í™€ë¦¬ë°ì´ ë¹„ì(ì„œë¸Œí´ë˜ìŠ¤ 417) ì†Œì§€ìëŠ” ì„¸ì»¨ë¹„ì(ë‘ ë²ˆì§¸ ì›Œí‚¹í™€ë¦¬ë°ì´ ë¹„ì)ë¥¼ ì‹ ì²­í•˜ê¸° ìœ„í•´ í˜¸ì£¼ ì§€ì—­ ì§€ì—­ì—ì„œ 88ì¼ì˜ íŠ¹ì • ì‘ì—…ì„ ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤. ìš°ë¦¬ì˜ ì„¸ì»¨ì§€ë„ëŠ” í˜¸ì£¼ ì „ì—­ì˜ ëª¨ë“  í•´ë‹¹ ìš°í¸ë²ˆí˜¸ì™€ ì‘ì—… ì§€ì—­ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
  </section>
  
  <section lang="ko">
    <h3>ì„¸ì»¨ë¹„ì ì§€ë„ ì‚¬ìš©ë²•</h3>
    <p>ìš°í¸ë²ˆí˜¸ë‚˜ ì§€ì—­ëª…ìœ¼ë¡œ ê²€ìƒ‰í•˜ì—¬ ì„¸ì»¨ë¹„ì ì¡°ê±´ì— ë§ëŠ” ì¼ìë¦¬ë¥¼ ì°¾ì•„ë³´ì„¸ìš”. ìƒ‰ìƒë³„ ì§€ì—­ì„ í´ë¦­í•˜ë©´ ìì„¸í•œ ì‘ì—… ìš”êµ¬ì‚¬í•­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì‹œê°„ ì±„íŒ…ìœ¼ë¡œ ë‹¤ë¥¸ ì›Œí™€ëŸ¬ë“¤ê³¼ ì •ë³´ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”.</p>
  </section>
  
  <section lang="ko">
    <h3>í˜¸ì£¼ì›Œí™€ 88ì¼ ì‘ì—… ì¢…ë¥˜</h3>
    <h4>ë†ì—… ë° 1ì°¨ ì‚°ì—… (ì§€ì—­ í˜¸ì£¼)</h4>
    <p>ë†ì¥ ì¼ìë¦¬, ëª©ì¶•ì—…, ì–´ì—…, ì„ì—…, ê´‘ì—… ë“± í˜¸ì£¼ ì§€ì—­ ì§€ì—­ì—ì„œì˜ 1ì°¨ ì‚°ì—… ì‘ì—…ìœ¼ë¡œ ì„¸ì»¨ë¹„ì ì¡°ê±´ì„ ì¶©ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    
    <h4>ê´€ê´‘ ë° ì ‘ê°ì—… (ì›ê²© ì§€ì—­)</h4>
    <p>í˜¸í…”, ì¹´í˜, ë ˆìŠ¤í† ë‘, ìˆ™ë°•ì—…ì†Œ ë“± ì›ê²© ì§€ì—­ì—ì„œì˜ ê´€ê´‘ ë° ì ‘ê°ì—… ì¼ìë¦¬ë„ 2021ë…„ 6ì›” 22ì¼ë¶€í„° ì„¸ì»¨ë¹„ì ì¡°ê±´ìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤.</p>
    
    <h4>ìì—°ì¬í•´ ë³µêµ¬ ì‘ì—…</h4>
    <p>ì‚°ë¶ˆ, í™ìˆ˜, ì‚¬ì´í´ë¡  í”¼í•´ ì§€ì—­ì˜ ë³µêµ¬ ì‘ì—…ë„ ì„¸ì»¨ë¹„ì ì¡°ê±´ì— í•´ë‹¹í•©ë‹ˆë‹¤.</p>
  </section>
  
  <section lang="ko">
    <h3>ì„¸ì»¨ë¹„ì ì§€ë„ ì£¼ìš” ê¸°ëŠ¥</h3>
    <ul>
      <li>2000ê°œ ì´ìƒì˜ í•´ë‹¹ ìš°í¸ë²ˆí˜¸ê°€ í¬í•¨ëœ ì¸í„°ë™í‹°ë¸Œ ì§€ë„</li>
      <li>ìš°í¸ë²ˆí˜¸ ë° ì§€ì—­ëª… ì‹¤ì‹œê°„ ê²€ìƒ‰</li>
      <li>ê° ì§€ì—­ ìœ í˜•ë³„ ìƒì„¸í•œ ì‘ì—… ìš”êµ¬ì‚¬í•­ ì •ë³´</li>
      <li>ì •ë¶€ ê³µì‹ ì¶œì²˜ ì°¸ì¡°</li>
      <li>ì›Œí™€ëŸ¬ë¥¼ ìœ„í•œ ì‹¤ì‹œê°„ ì±„íŒ… ì»¤ë®¤ë‹ˆí‹°</li>
      <li>ëª¨ë°”ì¼ ì¹œí™”ì  ë°˜ì‘í˜• ë””ìì¸</li>
    </ul>
  </section>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* 1. ì§€ë„ */
const map = L.map('map').setView([-27, 133], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'Â© OpenStreetMap contributors'
}).addTo(map);

/* 2. POA í´ë¦¬ê³¤ ë¶ˆëŸ¬ì˜¤ê¸° */
let localityTable = {}; // postcode â†’ locality
let geoLayer; // ê²€ìƒ‰ì„ ìœ„í•´ ì €ì¥
let highlightedLayer = null; // í˜„ì¬ ê°•ì¡°ëœ ë ˆì´ì–´
let table1Postcodes = new Set(); // table 1 (ë¹¨ê°„ìƒ‰)
let table2Postcodes = new Set(); // table 2 (ì£¼í™©ìƒ‰)
let table3Postcodes = new Set(); // table 3 (ë…¸ë€ìƒ‰)
let table4Postcodes = new Set(); // table 4 (ì´ˆë¡ìƒ‰)
let table5Postcodes = new Set(); // table 5 (íŒŒë€ìƒ‰)
let table6Postcodes = new Set(); // table 6 (ë³´ë¼ìƒ‰)

// CSV íŒŒì¼ë“¤ì—ì„œ ìš°í¸ë²ˆí˜¸ íŒŒì‹±
function parsePostcodes(postcodeStr) {
  const postcodes = [];
  const parts = postcodeStr.split(',').map(s => s.trim());
  
  for (let part of parts) {
    if (part.includes(' to ')) {
      const [start, end] = part.split(' to ').map(s => parseInt(s.trim()));
      for (let i = start; i <= end; i++) {
        postcodes.push(i.toString());
      }
    } else {
      postcodes.push(part);
    }
  }
  return postcodes;
}

// ì „ì²´ ì£¼/í…Œë¦¬í† ë¦¬ ìš°í¸ë²ˆí˜¸ ì¶”ê°€ í•¨ìˆ˜
function addAllPostcodes(state, targetSet) {
  if (state.includes('Northern Territory') || state.includes('ACT')) {
    for (let i = 800; i <= 999; i++) {
      targetSet.add('0' + i);
    }
    for (let i = 200; i <= 299; i++) {
      targetSet.add('0' + i);
    }
  } else if (state.includes('South Australia')) {
    for (let i = 5000; i <= 5999; i++) {
      targetSet.add(i.toString());
    }
  } else if (state.includes('Tasmania')) {
    for (let i = 7000; i <= 7999; i++) {
      targetSet.add(i.toString());
    }
  } else if (state.includes('Norfolk Island')) {
    targetSet.add('2899');
  }
}

Promise.all([
  fetch('postcode2name.json').then(r => r.json()),
  Promise.all([
    "data/geo_chunk_0.json", "data/geo_chunk_1.json", "data/geo_chunk_2.json", "data/geo_chunk_3.json", 
    "data/geo_chunk_4.json", "data/geo_chunk_5.json", "data/geo_chunk_6.json", "data/geo_chunk_7.json",
    "data/geo_chunk_8.json", "data/geo_chunk_9.json", "data/geo_chunk_10.json", "data/geo_chunk_11.json",
    "data/geo_chunk_12.json", "data/geo_chunk_13.json", "data/geo_chunk_14.json", "data/geo_chunk_15.json",
    "data/geo_chunk_16.json", "data/geo_chunk_17.json", "data/geo_chunk_18.json", "data/geo_chunk_19.json",
    "data/geo_chunk_20.json", "data/geo_chunk_21.json", "data/geo_chunk_22.json", "data/geo_chunk_23.json",
    "data/geo_chunk_24.json", "data/geo_chunk_25.json", "data/geo_chunk_26.json"
  ].map(file => fetch(file).then(r => r.json()))
  ).then(chunks => {
    const allFeatures = [];
    chunks.forEach(chunk => allFeatures.push(...chunk.features));
    return { type: 'FeatureCollection', features: allFeatures };
  }),
  fetch('data/table1.csv').then(r => r.text()),
  fetch('data/table2.csv').then(r => r.text()),
  fetch('data/table3.csv').then(r => r.text()),
  fetch('data/table4.csv').then(r => r.text()),
  fetch('data/table5.csv').then(r => r.text()),
  fetch('data/table6.csv').then(r => r.text())
])
.then(([nameMap, geo, table1, table2, table3, table4, table5, table6]) => {
  localityTable = nameMap;
  
  // ê° í…Œì´ë¸”ì—ì„œ ìš°í¸ë²ˆí˜¸ ì¶”ì¶œ
  const tableSets = [table1Postcodes, table2Postcodes, table3Postcodes, table4Postcodes, table5Postcodes, table6Postcodes];
  const csvFiles = [table1, table2, table3, table4, table5, table6];
  
  csvFiles.forEach((csvText, tableIndex) => {
    const lines = csvText.split('\n').slice(1);
    lines.forEach(line => {
      if (line.trim()) {
        const firstCommaIndex = line.indexOf(',');
        if (firstCommaIndex > 0) {
          const state = line.substring(0, firstCommaIndex).trim();
          const postcodes = line.substring(firstCommaIndex + 1).trim().replace(/"/g, '');
          
          if (postcodes && !postcodes.includes('All') && postcodes !== 'All areas.') {
            const codes = postcodes.split(',').map(s => s.trim()).filter(s => s);
            codes.forEach(code => tableSets[tableIndex].add(code));
          } else if (postcodes && (postcodes.includes('All') || postcodes === 'All areas.')) {
            addAllPostcodes(state, tableSets[tableIndex]);
          }
        }
      }
    });
  });
  
  // ìƒ‰ìƒ ì •ì˜
  const tableColors = ['#ff0000', '#ff8c00', '#ffff00', '#32cd32', '#0078ff', '#9370db']; // ë¹¨ê°•, ì£¼í™©, ë…¸ë‘, ë¼ì„ê·¸ë¦°, íŒŒë‘, ë³´ë¼
  
  geoLayer = L.geoJSON(geo, {
    style: (feature) => {
      const pcode = feature.properties.POA_CODE_2021;
      
      // ê° í…Œì´ë¸” ìˆœì„œëŒ€ë¡œ í™•ì¸
      for (let i = 0; i < tableSets.length; i++) {
        if (tableSets[i].has(pcode)) {
          return { color: tableColors[i], weight: 1, fillOpacity: 0.5 };
        }
      }
      
      // ì–´ë–¤ í…Œì´ë¸”ì—ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ íŒŒë€ìƒ‰
      return { color: '#87ceeb', weight: 1, fillOpacity: 0.3 };
    },
    onEachFeature: (feature, layer) => {
      const pcode = feature.properties.POA_CODE_2021;
      const name  = localityTable[pcode] || 'Unknown';
      layer.bindTooltip(`${name}, ${pcode}`, { sticky: true });
      layer.pcode = pcode;
      layer.name = name;
      
      // ì›ë˜ ìŠ¤íƒ€ì¼ ì €ì¥
      let originalColor = '#87ceeb';
      for (let i = 0; i < tableSets.length; i++) {
        if (tableSets[i].has(pcode)) {
          originalColor = tableColors[i];
          break;
        }
      }
      layer.originalStyle = { color: originalColor, weight: 1, fillOpacity: 0.5 };
      
      // í´ë¦¬ê³¤ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
      layer.on('click', function(e) {
        highlightLayer(layer);
        L.DomEvent.stopPropagation(e);
      });
    }
  }).addTo(map);
  
  setupSearch();
  initVisitorStats();
  
  // ë¡œë”© ì™„ë£Œ í›„ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
  document.getElementById('loading-overlay').style.display = 'none';
  
  // ì±„íŒ… ì´ˆê¸°í™”
  initChat();
})
.catch(err => {
  console.error('ì „ì²´ ë¡œë”© ì‹¤íŒ¨:', err);
  alert('ë¡œë”© ì‹¤íŒ¨: ' + err.message);
});

/* 5. Firebase ë°©ë¬¸ì í†µê³„ ê¸°ëŠ¥ */
function initVisitorStats() {
  // Firebase ë¡œë”© ëŒ€ê¸°
  setTimeout(() => {
    if (window.firebaseDB) {
      setupFirebaseVisitorStats();
    } else {
      // Firebase ì‹¤íŒ¨ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©
      setupLocalVisitorStats();
    }
  }, 1500); // ì±„íŒ…ë³´ë‹¤ ì¡°ê¸ˆ ëŠ¦ê²Œ ë¡œë”©
}

function setupFirebaseVisitorStats() {
  const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•íƒœ
  const visitorId = getOrCreateVisitorId();
  
  // Firebaseì—ì„œ í†µê³„ ë°ì´í„° ì‹¤ì‹œê°„ ì¡°íšŒ
  const statsRef = window.firebaseRef(window.firebaseDB, 'statistics');
  window.firebaseOnValue(statsRef, (snapshot) => {
    const data = snapshot.val() || {};
    displayVisitorStats(data);
  });
  
  // ë°©ë¬¸ ê¸°ë¡
  recordVisit(today, visitorId);
}

function getOrCreateVisitorId() {
  let visitorId = localStorage.getItem('visitorId');
  if (!visitorId) {
    visitorId = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('visitorId', visitorId);
  }
  return visitorId;
}

async function recordVisit(today, visitorId) {
  const lastVisit = localStorage.getItem('lastFirebaseVisit');
  const shouldRecord = lastVisit !== today;
  
  if (shouldRecord) {
    try {
      // ì˜¤ëŠ˜ ë°©ë¬¸ìë¡œ ê¸°ë¡ (ì¤‘ë³µ ë°©ì§€)
      const todayVisitorRef = window.firebaseRef(window.firebaseDB, `statistics/dailyVisitors/${today}/${visitorId}`);
      await window.firebaseSet(todayVisitorRef, {
        timestamp: window.firebaseServerTimestamp(),
        date: today
      });
      
      // ì´ ë°©ë¬¸ì ìˆ˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì¦ê°€
      const totalRef = window.firebaseRef(window.firebaseDB, 'statistics/totalVisitors');
      await window.firebaseRunTransaction(totalRef, (currentValue) => {
        return (currentValue || 0) + 1;
      });
      
      localStorage.setItem('lastFirebaseVisit', today);
      console.log('âœ… Visit recorded to Firebase');
      
    } catch (error) {
      console.error('âŒ Failed to record visit:', error);
      // Firebase ì‹¤íŒ¨ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¡œ í´ë°±
      setupLocalVisitorStats();
    }
  }
}

function displayVisitorStats(data) {
  const today = new Date().toISOString().split('T')[0];
  const totalVisitors = data.totalVisitors || 0;
  const todayVisitors = data.dailyVisitors && data.dailyVisitors[today] ? 
    Object.keys(data.dailyVisitors[today]).length : 0;
  
  document.getElementById('total-visitors').textContent = totalVisitors.toLocaleString();
  document.getElementById('today-visitors').textContent = todayVisitors.toLocaleString();
}

function setupLocalVisitorStats() {
  const today = new Date().toDateString();
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°©ë¬¸ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  let totalVisitors = parseInt(localStorage.getItem('totalVisitors') || '0');
  let todayVisitors = parseInt(localStorage.getItem('todayVisitors') || '0');
  let lastVisitDate = localStorage.getItem('lastVisitDate') || '';
  
  // ì˜¤ëŠ˜ ì²« ë°©ë¬¸ì¸ì§€ í™•ì¸
  if (lastVisitDate !== today) {
    todayVisitors = 0;
    localStorage.setItem('lastVisitDate', today);
  }
  
  // ë°©ë¬¸ì ìˆ˜ ì¦ê°€
  totalVisitors += 1;
  todayVisitors += 1;
  
  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
  localStorage.setItem('totalVisitors', totalVisitors.toString());
  localStorage.setItem('todayVisitors', todayVisitors.toString());
  
  // í™”ë©´ì— í‘œì‹œ
  document.getElementById('total-visitors').textContent = totalVisitors.toLocaleString();
  document.getElementById('today-visitors').textContent = todayVisitors.toLocaleString();
}

/* 6. ì •ë³´ íŒ¨ë„ ê¸°ëŠ¥ */
function showInfo(tableNum) {
  const infoData = {
    1: {
      title: "Remote and Very Remote Australia (Table 1)",
      content: `<strong>Work Requirements:</strong><br>
        Tourism and hospitality work carried out from 22 June 2021 in the following areas of Remote and Very Remote Australia is considered eligible specified work for the purpose of a second or third Working Holiday (subclass 417) visa application lodged from 5 March 2022.`
    },
    2: {
      title: "Australia (Table 2)",
      content: `<strong>Work Requirements:</strong><br>
        Tourism and hospitality work carried out from 22 June 2021 in the following areas of Australia is considered eligible specified work for the purpose of a second or third Working Holiday (subclass 417) visa application lodged from 1 July 2022.`
    },
    3: {
      title: "Northern Australia (Table 3)",
      content: `<strong>Work Requirements:</strong><br>
        Tourism and hospitality work carried out from 22 June 2021 in the following areas of Northern Australia is considered eligible specified work for the purpose of a second or third Working Holiday (subclass 417) visa application lodged from 5 March 2022.`
    },
    4: {
      title: "Regional Australia (Table 4)",
      content: `<strong>Work Requirements:</strong><br>
        Specified work carried out in the following areas of regional Australia is considered eligible specified work for the purpose of a second or third Working Holiday (subclass 417) visa.`
    },
    5: {
      title: "Bushfire Declared Areas (Table 5)",
      content: `<strong>Work Requirements:</strong><br>
        Bushfire recovery work carried out after 31 July 2019 in the following areas is considered specified work for the purpose of a second or third Working Holiday (subclass 417) visa.`
    },
    6: {
      title: "Natural Disaster Declared Areas (Table 6)",
      content: `<strong>Work Requirements:</strong><br>
        Recovery work carried out from 31 December 2021 in the following areas of Australia, that have been declared affected by other natural disasters, such as flood, cyclones or other severe weather events, is considered eligible for specified work for the purpose of a second or third Working Holiday (subclass 417) visa.<br><br>
        <strong>Application Requirements:</strong><br>
        This applies to applications lodged on or after 5 April 2025 and undecided applications on this date.`
    }
  };

  const info = infoData[tableNum];
  document.getElementById('info-title').textContent = info.title;
  document.getElementById('info-content').innerHTML = info.content;
  document.getElementById('info-panel').style.display = 'block';
}

function hideInfo() {
  document.getElementById('info-panel').style.display = 'none';
}

/* 3. ê²€ìƒ‰ ê¸°ëŠ¥ */
function setupSearch() {
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');
  
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    if (query.length < 2) {
      searchResults.style.display = 'none';
      return;
    }
    
    const results = [];
    geoLayer.eachLayer(layer => {
      const pcode = layer.pcode;
      const name = layer.name;
      if (pcode.includes(query) || name.toLowerCase().includes(query.toLowerCase())) {
        results.push({ pcode, name, layer });
      }
    });
    
    if (results.length > 0) {
      searchResults.innerHTML = results.slice(0, 10).map(result => 
        `<div class="search-result" data-pcode="${result.pcode}">${result.name}, ${result.pcode}</div>`
      ).join('');
      searchResults.style.display = 'block';
    } else {
      searchResults.style.display = 'none';
    }
  });
  
  searchResults.addEventListener('click', function(e) {
    if (e.target.classList.contains('search-result')) {
      const pcode = e.target.dataset.pcode;
      geoLayer.eachLayer(layer => {
        if (layer.pcode === pcode) {
          highlightLayer(layer);
          map.fitBounds(layer.getBounds());
          layer.openTooltip();
        }
      });
      searchResults.style.display = 'none';
      searchInput.value = '';
    }
  });
  
  document.addEventListener('click', function(e) {
    if (!e.target.closest('#search-container')) {
      searchResults.style.display = 'none';
    }
  });
}

/* 4. ë ˆì´ì–´ ê°•ì¡° ê¸°ëŠ¥ */
function highlightLayer(layer) {
  // ì´ì „ ê°•ì¡° í•´ì œ
  if (highlightedLayer) {
    highlightedLayer.setStyle(highlightedLayer.originalStyle);
  }
  
  // ì›ë˜ ìƒ‰ìƒì„ ë” ì§„í•˜ê²Œ ë§Œë“¤ì–´ ê°•ì¡°
  const originalColor = layer.originalStyle.color;
  const darkerColor = getDarkerColor(originalColor);
  
  layer.setStyle({
    color: darkerColor,
    weight: 3,
    fillOpacity: 0.8
  });
  
  highlightedLayer = layer;
}

// ìƒ‰ìƒì„ ë” ì§„í•˜ê²Œ ë§Œë“œëŠ” í•¨ìˆ˜
function getDarkerColor(hexColor) {
  const colorMap = {
    '#ff0000': '#cc0000', // ë¹¨ê°„ìƒ‰ -> ë” ì§„í•œ ë¹¨ê°„ìƒ‰
    '#ff8c00': '#e6660a', // ì£¼í™©ìƒ‰ -> ë” ì§„í•œ ì£¼í™©ìƒ‰
    '#ffff00': '#cccc00', // ë…¸ë€ìƒ‰ -> ë” ì§„í•œ ë…¸ë€ìƒ‰
    '#32cd32': '#228b22', // ë¼ì„ê·¸ë¦° -> ë” ì§„í•œ ì´ˆë¡ìƒ‰
    '#0078ff': '#0056cc', // íŒŒë€ìƒ‰ -> ë” ì§„í•œ íŒŒë€ìƒ‰
    '#9370db': '#7b68ee', // ë³´ë¼ìƒ‰ -> ë” ì§„í•œ ë³´ë¼ìƒ‰
    '#87ceeb': '#5f9ea0'  // ì—°í•œ íŒŒë€ìƒ‰ -> ë” ì§„í•œ íŒŒë€ìƒ‰
  };
  
  return colorMap[hexColor] || hexColor;
}

// ì§€ë„ í´ë¦­ì‹œ ê°•ì¡° í•´ì œ
map.on('click', function(e) {
  if (highlightedLayer) {
    highlightedLayer.setStyle(highlightedLayer.originalStyle);
    highlightedLayer = null;
  }
});

/* 7. Firebase ì‹¤ì‹œê°„ ì±„íŒ… ê¸°ëŠ¥ */
function initChat() {
  // Firebase ë¡œë”© ëŒ€ê¸° í›„ ì±„íŒ… ì„¤ì •
  setTimeout(() => {
    if (window.chatBackend && window.chatBackend.enabled && window.firebaseDB) {
      setupFirebaseChat();
      showChatStatus('ğŸ”¥ Real-time chat connected!');
    } else {
      loadMessages();
      showChatStatus('ğŸ’¬ Local chat only - Firebase connection failed');
    }
  }, 1000); // Firebase ë¡œë”© ëŒ€ê¸°
  
  // Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
  document.getElementById('chat-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      sendMessage();
    }
  });
  
  document.getElementById('username-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      document.getElementById('chat-input').focus();
    }
  });
  
  // ì €ì¥ëœ ì‚¬ìš©ìëª… ë¶ˆëŸ¬ì˜¤ê¸°
  const savedUsername = localStorage.getItem('guestbookUsername');
  if (savedUsername) {
    document.getElementById('username-input').value = savedUsername;
  }
}

function setupFirebaseChat() {
  // Firebase ì‹¤ì‹œê°„ ë©”ì‹œì§€ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  const messagesRef = window.firebaseRef(window.firebaseDB, 'messages');
  const messagesQuery = window.firebaseQuery(messagesRef, window.firebaseLimitToLast(50));
  
  window.firebaseOnValue(messagesQuery, (snapshot) => {
    const data = snapshot.val();
    displayFirebaseMessages(data);
  }, (error) => {
    console.error('Firebase error:', error);
    showChatStatus('âŒ Real-time chat error - using local storage');
    loadMessages();
  });
}

function showChatStatus(message) {
  const header = document.getElementById('chat-header');
  const statusSpan = document.getElementById('chat-status');
  
  header.title = message;
  
  // ìƒíƒœ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
  if (message.includes('Real-time chat connected')) {
    statusSpan.textContent = 'ğŸ”¥';
    statusSpan.title = 'Real-time chat active';
  } else if (message.includes('Local chat only')) {
    statusSpan.textContent = 'ğŸ’¾';
    statusSpan.title = 'Local storage only';
  } else if (message.includes('error') || message.includes('Failed')) {
    statusSpan.textContent = 'âŒ';
    statusSpan.title = 'Connection error';
  } else {
    statusSpan.textContent = 'ğŸ”„';
    statusSpan.title = 'Connecting...';
  }
  
  // 5ì´ˆ í›„ íˆ´íŒ ì œê±°
  setTimeout(() => {
    header.title = '';
  }, 5000);
}

function toggleChat() {
  const content = document.getElementById('chat-content');
  const container = document.getElementById('chat-container');
  
  if (content.style.display === 'none' || content.style.display === '') {
    content.style.display = 'block';
    container.classList.remove('chat-collapsed');
  } else {
    content.style.display = 'none';
    container.classList.add('chat-collapsed');
  }
}

function sendMessage() {
  const input = document.getElementById('chat-input');
  const usernameInput = document.getElementById('username-input');
  const message = input.value.trim();
  const username = usernameInput.value.trim() || 'Anonymous';
  
  if (message) {
    // ì‚¬ìš©ìëª…ì„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ë‹¤ìŒì— ìë™ ì…ë ¥)
    localStorage.setItem('guestbookUsername', username);
    
    if (window.chatBackend && window.chatBackend.enabled && window.firebaseDB) {
      // Firebaseì— ë©”ì‹œì§€ ì „ì†¡
      const messagesRef = window.firebaseRef(window.firebaseDB, 'messages');
      const messageData = {
        text: message,
        author: username,
        timestamp: window.firebaseServerTimestamp()
      };
      
      window.firebasePush(messagesRef, messageData).then(() => {
        console.log('âœ… Message sent to Firebase');
      }).catch((error) => {
        console.error('âŒ Firebase send error:', error);
        // Firebase ì‹¤íŒ¨ì‹œ ë¡œì»¬ ì €ì¥ìœ¼ë¡œ í´ë°±
        saveToLocalStorage(message, username);
        showChatStatus('âŒ Failed to send - saved locally');
      });
    } else {
      // Firebase ì—†ìœ¼ë©´ ë¡œì»¬ ì €ì¥
      saveToLocalStorage(message, username);
    }
    
    // ë©”ì‹œì§€ ì…ë ¥ì°½ë§Œ ë¹„ìš°ê¸° (ì‚¬ìš©ìëª…ì€ ìœ ì§€)
    input.value = '';
  }
}

function saveToLocalStorage(message, username) {
  const timestamp = new Date().toLocaleString();
  const messageObj = {
    text: message,
    author: username,
    time: timestamp
  };
  
  const messages = getMessages();
  messages.push(messageObj);
  
  // ìµœëŒ€ 50ê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€
  if (messages.length > 50) {
    messages.splice(0, messages.length - 50);
  }
  
  localStorage.setItem('guestbookMessages', JSON.stringify(messages));
  addMessageToChat(messageObj);
  
  const messagesContainer = document.getElementById('chat-messages');
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function getMessages() {
  const stored = localStorage.getItem('guestbookMessages');
  return stored ? JSON.parse(stored) : [];
}

function loadMessages() {
  const messages = getMessages();
  const container = document.getElementById('chat-messages');
  
  container.innerHTML = '';
  
  if (messages.length === 0) {
    container.innerHTML = '<div style="color:#999;text-align:center;padding:20px;">No messages yet. Be the first to leave a message!</div>';
  } else {
    messages.forEach(msg => addMessageToChat(msg));
    container.scrollTop = container.scrollHeight;
  }
}

function displayFirebaseMessages(data) {
  const container = document.getElementById('chat-messages');
  container.innerHTML = '';
  
  if (!data) {
    container.innerHTML = '<div style="color:#999;text-align:center;padding:20px;">ğŸ”¥ Real-time chat enabled! Be the first to leave a message!</div>';
    return;
  }
  
  // Firebase ë©”ì‹œì§€ë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ê³  ì‹œê°„ìˆœ ì •ë ¬
  const messages = Object.entries(data).map(([key, value]) => ({
    ...value,
    id: key
  })).sort((a, b) => {
    // timestampê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ í˜„ì¬ ì‹œê°„
    const timeA = a.timestamp || Date.now();
    const timeB = b.timestamp || Date.now();
    return timeA - timeB;
  });
  
  // ìµœê·¼ 50ê°œë§Œ í‘œì‹œ
  const recentMessages = messages.slice(-50);
  
  recentMessages.forEach(msg => {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message';
    
    const displayTime = msg.timestamp ? 
      new Date(msg.timestamp).toLocaleString() : 
      (msg.time || 'Just now');
    
    messageDiv.innerHTML = `
      <div class="message-header">
        <div class="message-author">${escapeHtml(msg.author || 'Anonymous')}</div>
        <div class="message-time">${displayTime}</div>
      </div>
      <div class="message-text">${escapeHtml(msg.text || '')}</div>
    `;
    
    container.appendChild(messageDiv);
  });
  
  container.scrollTop = container.scrollHeight;
}

function addMessageToChat(messageObj) {
  const container = document.getElementById('chat-messages');
  const messageDiv = document.createElement('div');
  messageDiv.className = 'message';
  
  // ì²« ë²ˆì§¸ ë©”ì‹œì§€ì¸ ê²½ìš° í™˜ì˜ ë©”ì‹œì§€ ì œê±°
  if (container.querySelector('[style*="color:#999"]')) {
    container.innerHTML = '';
  }
  
  messageDiv.innerHTML = `
    <div class="message-header">
      <div class="message-author">${escapeHtml(messageObj.author || 'Anonymous')}</div>
      <div class="message-time">${messageObj.time}</div>
    </div>
    <div class="message-text">${escapeHtml(messageObj.text)}</div>
  `;
  
  container.appendChild(messageDiv);
}

// HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

/* 8. ì´ë©”ì¼ ë³µì‚¬ ê¸°ëŠ¥ */
function copyEmail(event) {
  event.preventDefault();
  const email = 'somanytube@gmail.com';
  
  // í´ë¦½ë³´ë“œì— ë³µì‚¬
  navigator.clipboard.writeText(email).then(function() {
    // ë³µì‚¬ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
    showCopyMessage('ğŸ“§ Email copied to clipboard!');
  }).catch(function() {
    // ëŒ€ì²´ ë°©ë²• (êµ¬ë ¨ ë¸Œë¼ìš°ì €)
    const textArea = document.createElement('textarea');
    textArea.value = email;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showCopyMessage('ğŸ“§ Email copied to clipboard!');
  });
}

function showCopyMessage(message) {
  // ê¸°ì¡´ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ ì œê±°
  const existingMsg = document.getElementById('copy-message');
  if (existingMsg) {
    existingMsg.remove();
  }
  
  // ë©”ì‹œì§€ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
  const messageDiv = document.createElement('div');
  messageDiv.id = 'copy-message';
  messageDiv.textContent = message;
  messageDiv.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(74, 144, 226, 0.9);
    color: white;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-family: Arial, sans-serif;
    z-index: 10000;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    animation: fadeInOut 2s ease-in-out;
  `;
  
  // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
  if (!document.getElementById('copy-animation-style')) {
    const style = document.createElement('style');
    style.id = 'copy-animation-style';
    style.textContent = `
      @keyframes fadeInOut {
        0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
      }
    `;
    document.head.appendChild(style);
  }
  
  document.body.appendChild(messageDiv);
  
  // 2ì´ˆ í›„ ìë™ ì œê±°
  setTimeout(() => {
    if (messageDiv.parentNode) {
      messageDiv.remove();
    }
  }, 2000);
}
</script>
</body>
</html>